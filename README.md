# üöÄ Prometei Flow - CRM Integration with Inngest

–°–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å CRM –Ω–∞ –±–∞–∑–µ Inngest –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhooks –æ—Ç amoCRM –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–æ–∫.

## üìã –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **Webhook –æ—Ç amoCRM** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö webhooks
- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –≤ CRM** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–µ–π CRM —Å–∏—Å—Ç–µ–º–æ–π
- ‚úÖ **–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - —Å–æ–∑–¥–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
- ‚úÖ **Fault tolerance** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ retry –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ø–æ–ª–Ω–∞—è observability —á–µ—Ä–µ–∑ Inngest Dashboard
- ‚úÖ **–¢–∏–ø–∏–∑–∞—Ü–∏—è** - –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ TypeScript

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Inngest** - –æ—Å–Ω–æ–≤–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è workflow orchestration
- **TypeScript** - —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JavaScript
- **Node.js** - —Å–µ—Ä–≤–µ—Ä–Ω–∞—è —Å—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **Next.js** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```

### 3. –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –ó–∞–ø—É—Å–∫ Inngest dev —Å–µ—Ä–≤–µ—Ä–∞
npm run inngest

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Next.js)
npm run dev
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏
npm run test

# –¢–µ—Å—Ç webhook
npm run test:webhook

# –í—Å–µ —Ç–µ—Å—Ç—ã
node scripts/test-inngest.js all
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
prometei-flow/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ inngest/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.ts              # Inngest –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ functions/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ createCrmDeal.ts   # CRM —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îî‚îÄ‚îÄ inngest.ts             # API endpoint
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ test-inngest.js           # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ test-webhook.js           # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhooks
‚îú‚îÄ‚îÄ inngest.config.ts             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Inngest
‚îî‚îÄ‚îÄ package.json
```

## üîß –§—É–Ω–∫—Ü–∏–∏ Inngest

### 1. `createCrmDeal` - –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏ –≤ CRM

```typescript
// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è
await inngest.send({
  name: "crm/create-deal",
  data: {
    dealName: "–ù–æ–≤–∞—è —Å–¥–µ–ª–∫–∞",
    amount: 15000,
    entityId: 70
  }
});
```

### 2. `handleAmoCrmWebhook` - –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook –æ—Ç amoCRM

```typescript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç webhook –æ—Ç amoCRM
// URL: https://your-domain.com/api/inngest
```

### 3. `batchCreateCrmDeals` - –ü–∞–∫–µ—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫

```typescript
// –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∞–∫–µ—Ç–∞
await inngest.send({
  name: "crm/batch-create-deals", 
  data: {
    deals: [
      { dealName: "–°–¥–µ–ª–∫–∞ 1", amount: 10000 },
      { dealName: "–°–¥–µ–ª–∫–∞ 2", amount: 20000 }
    ]
  }
});
```

## üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –≤ amoCRM

1. –í–æ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ amoCRM
2. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "Webhooks" –∏–ª–∏ "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"
3. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π webhook:
   - **URL:** `https://your-domain.com/api/inngest`
   - **–°–æ–±—ã—Ç–∏—è:** –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
   - **–ú–µ—Ç–æ–¥:** POST

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Inngest Dashboard
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [app.inngest.com](https://app.inngest.com)
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
# Inngest dev —Å–µ—Ä–≤–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è
npm run inngest
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –æ–¥–Ω–æ–π —Å–¥–µ–ª–∫–∏
node scripts/test-inngest.js create "–¢–µ—Å—Ç —Å–¥–µ–ª–∫–∞" 15000 70

# Webhook –æ—Ç amoCRM
node scripts/test-inngest.js webhook

# –ü–∞–∫–µ—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ
node scripts/test-inngest.js batch

# HTTP endpoint
node scripts/test-inngest.js http

# –í—Å–µ —Ç–µ—Å—Ç—ã
node scripts/test-inngest.js all
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook:

```bash
# –û—Å–Ω–æ–≤–Ω–æ–π webhook —Ç–µ—Å—Ç
node scripts/test-webhook.js

# –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π
node scripts/test-webhook.js events

# –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
node scripts/test-webhook.js performance
```

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è |
|------------|----------|--------------|
| `INNGEST_EVENT_KEY` | –ö–ª—é—á –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π | –î–∞ |
| `INNGEST_SIGNING_KEY` | –ö–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ | –î–∞ |
| `CRM_API_URL` | URL CRM API | –î–∞ |
| `CRM_API_KEY` | –ö–ª—é—á CRM API | –î–∞ |
| `CRM_API_USERNAME` | –õ–æ–≥–∏–Ω CRM | –î–∞ |
| `CRM_API_PASSWORD` | –ü–∞—Ä–æ–ª—å CRM | –î–∞ |

## üöÄ –î–µ–ø–ª–æ–π

### Vercel (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Vercel CLI
npm i -g vercel

# –î–µ–ø–ª–æ–π
vercel

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel Dashboard
```

### –î—Ä—É–≥–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- Railway
- Netlify
- Heroku
- AWS Lambda

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å Trigger.dev

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å Trigger.dev –Ω–∞ Inngest:

- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Trigger.dev
- ‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞–Ω—ã –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ Inngest
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ webhooks

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Inngest Documentation](https://www.inngest.com/docs)
- [Inngest TypeScript SDK](https://www.inngest.com/docs/sdk/typescript)
- [Webhook Integration Guide](https://www.inngest.com/docs/guides/webhooks)

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Inngest Dashboard
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã: `npm run test`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å Inngest dev —Å–µ—Ä–≤–µ—Ä–∞

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
